<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class ActiveMerchant::Billing::PayJunctionGateway - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
  var index_rel_prefix = "../../";
</script>

<script src="../../js/navigation.js" defer></script>
<script src="../../js/search.js" defer></script>
<script src="../../js/search_index.js" defer></script>
<script src="../../js/searcher.js" defer></script>
<script src="../../js/darkfish.js" defer></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">




<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link"><a href="Gateway.html">ActiveMerchant::Billing::Gateway</a>
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li class="calls-super" ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-authorize">#authorize</a>
    
    <li ><a href="#method-i-capture">#capture</a>
    
    <li ><a href="#method-i-credit">#credit</a>
    
    <li ><a href="#method-i-purchase">#purchase</a>
    
    <li ><a href="#method-i-recurring">#recurring</a>
    
    <li ><a href="#method-i-refund">#refund</a>
    
    <li class="calls-super" ><a href="#method-i-test-3F">#test?</a>
    
    <li ><a href="#method-i-void">#void</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-ActiveMerchant::Billing::PayJunctionGateway">
  <h1 id="class-ActiveMerchant::Billing::PayJunctionGateway" class="class">
    class ActiveMerchant::Billing::PayJunctionGateway
  </h1>

  <section class="description">
    
<p>PayJunction <a href="Gateway.html"><code>Gateway</code></a></p>

<p>This gateway accepts the following arguments:</p>

<pre>:login    =&gt; your PayJunction username
:password =&gt; your PayJunction pass</pre>

<p>Example use:</p>

<pre class="ruby"><span class="ruby-identifier">gateway</span> = <span class="ruby-constant">ActiveMerchant</span><span class="ruby-operator">::</span><span class="ruby-constant">Billing</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">gateway</span>(<span class="ruby-value">:pay_junction</span>).<span class="ruby-identifier">new</span>(
            <span class="ruby-value">:login</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&quot;my_account&quot;</span>,
            <span class="ruby-value">:password</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&quot;my_pass&quot;</span>
         )

<span class="ruby-comment"># set up credit card obj as in main ActiveMerchant example</span>
<span class="ruby-identifier">creditcard</span> = <span class="ruby-constant">ActiveMerchant</span><span class="ruby-operator">::</span><span class="ruby-constant">Billing</span><span class="ruby-operator">::</span><span class="ruby-constant">CreditCard</span>.<span class="ruby-identifier">new</span>(
  <span class="ruby-value">:type</span>       <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;visa&#39;</span>,
  <span class="ruby-value">:number</span>     <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;4242424242424242&#39;</span>,
  <span class="ruby-value">:month</span>      <span class="ruby-operator">=&gt;</span> <span class="ruby-value">8</span>,
  <span class="ruby-value">:year</span>       <span class="ruby-operator">=&gt;</span> <span class="ruby-value">2009</span>,
  <span class="ruby-value">:first_name</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;Bob&#39;</span>,
  <span class="ruby-value">:last_name</span>  <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;Bobsen&#39;</span>
)

<span class="ruby-comment"># optionally specify address if using AVS</span>
<span class="ruby-identifier">address</span> = { <span class="ruby-value">:address1</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;101 Test Ave&#39;</span>, <span class="ruby-value">:city</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;Test&#39;</span>, <span class="ruby-value">:state</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;TS&#39;</span>,
            <span class="ruby-value">:zip</span>  <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;10101&#39;</span>, <span class="ruby-value">:country</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;US&#39;</span> }

<span class="ruby-comment"># run request</span>
<span class="ruby-identifier">response</span> = <span class="ruby-identifier">gateway</span>.<span class="ruby-identifier">purchase</span>(<span class="ruby-value">1000</span>, <span class="ruby-identifier">creditcard</span>, <span class="ruby-value">:address</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">address</span>) <span class="ruby-comment"># charge 10 dollars</span>
</pre>

<p>1) <a href="Check.html"><code>Check</code></a> whether the transaction was successful</p>

<pre class="ruby"><span class="ruby-identifier">response</span>.<span class="ruby-identifier">success?</span>
</pre>

<p>2) Retrieve the message returned by PayJunction</p>

<pre class="ruby"><span class="ruby-identifier">response</span>.<span class="ruby-identifier">message</span>
</pre>

<p>3) Retrieve the unique transaction ID returned by PayJunction</p>

<pre class="ruby"><span class="ruby-identifier">response</span>.<span class="ruby-identifier">authorization</span>
</pre>

<p>This gateway supports “instant” transactions. These transactions allow you to execute an operation on a previously run card without card information provided you have the transaction id from a previous transaction with the same card. All functions that take a credit card object for this gateway can take a transaction id string instead.</p>

<p>Test Transactions</p>

<p>See the source for initialize() for test account information. Note that PayJunction does not allow test transactions on your account, so if the gateway is running in :test mode your transaction will be run against PayJunction&#39;s global test account and will not show up in your account.</p>

<p>Transactions ran on this account go through a test processor, so there is no need to void or otherwise cancel transactions. However, for further safety, please use the special card numbers 4433221111223344 or 4444333322221111 and keep transaction amounts below $4.00 when testing.</p>

<p>Also note, transactions ran for an amount between $0.00 and $1.99 will likely result in denial. To demonstrate approvals, use amounts between $2.00 and $4.00.</p>

<p>Test transactions can be checked by logging into PayJunction Web Login with username &#39;pj-cm-01&#39; and password &#39;pj-cm-01p&#39;</p>

<p>Usage Details</p>

<p>Below is a map of values accepted by PayJunction and how you should submit each to <a href="../../ActiveMerchant.html"><code>ActiveMerchant</code></a></p>

<p>PayJunction Field       <a href="../../ActiveMerchant.html"><code>ActiveMerchant</code></a> Use</p>

<p>dc_logon                provide as :login value to gateway instantiation dc_password             provide as :password value to gateway instantiation</p>

<p>dc_name                 will be retrieved from credit_card.name dc_first_name           :first_name on <a href="CreditCard.html"><code>CreditCard</code></a> object instantiation dc_last_name            :last_name  on <a href="CreditCard.html"><code>CreditCard</code></a> object instantiation dc_number               :number     on <a href="CreditCard.html"><code>CreditCard</code></a> object instantiation dc_expiration_month     :month      on <a href="CreditCard.html"><code>CreditCard</code></a> object instantiation dc_expiration_year      :year       on <a href="CreditCard.html"><code>CreditCard</code></a> object instantiation dc_verification_number  :verification_value on CC object instantiation</p>

<p>dc_transaction_amount   include as argument to method for your transaction type dc_transaction_type     do nothing, set by your transaction type dc_version              do nothing, always “1.2”</p>

<p>dc_transaction_id       submit as a string in place of <a href="CreditCard.html"><code>CreditCard</code></a> obj for</p>

<pre>&quot;instant&quot; transactions.</pre>

<p>dc_invoice              :order_id in options for transaction method dc_notes                :description in options for transaction method</p>

<p>See example use above for address AVS fields See <a href="PayJunctionGateway.html#method-i-recurring"><code>recurring</code></a> for periodic transaction fields</p>

<p>PayJunction <a href="Gateway.html"><code>Gateway</code></a></p>

<p>This gateway accepts the following arguments:</p>

<pre>:login    =&gt; your PayJunction username
:password =&gt; your PayJunction pass</pre>

<p>Example use:</p>

<pre class="ruby"><span class="ruby-identifier">gateway</span> = <span class="ruby-constant">ActiveMerchant</span><span class="ruby-operator">::</span><span class="ruby-constant">Billing</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">gateway</span>(<span class="ruby-value">:pay_junction</span>).<span class="ruby-identifier">new</span>(
            <span class="ruby-value">:login</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&quot;my_account&quot;</span>,
            <span class="ruby-value">:password</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&quot;my_pass&quot;</span>
         )

<span class="ruby-comment"># set up credit card obj as in main ActiveMerchant example</span>
<span class="ruby-identifier">creditcard</span> = <span class="ruby-constant">ActiveMerchant</span><span class="ruby-operator">::</span><span class="ruby-constant">Billing</span><span class="ruby-operator">::</span><span class="ruby-constant">CreditCard</span>.<span class="ruby-identifier">new</span>(
  <span class="ruby-value">:type</span>       <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;visa&#39;</span>,
  <span class="ruby-value">:number</span>     <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;4242424242424242&#39;</span>,
  <span class="ruby-value">:month</span>      <span class="ruby-operator">=&gt;</span> <span class="ruby-value">8</span>,
  <span class="ruby-value">:year</span>       <span class="ruby-operator">=&gt;</span> <span class="ruby-value">2009</span>,
  <span class="ruby-value">:first_name</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;Bob&#39;</span>,
  <span class="ruby-value">:last_name</span>  <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;Bobsen&#39;</span>
)

<span class="ruby-comment"># optionally specify address if using AVS</span>
<span class="ruby-identifier">address</span> = { <span class="ruby-value">:address1</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;101 Test Ave&#39;</span>, <span class="ruby-value">:city</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;Test&#39;</span>, <span class="ruby-value">:state</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;TS&#39;</span>,
            <span class="ruby-value">:zip</span>  <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;10101&#39;</span>, <span class="ruby-value">:country</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;US&#39;</span> }

<span class="ruby-comment"># run request</span>
<span class="ruby-identifier">response</span> = <span class="ruby-identifier">gateway</span>.<span class="ruby-identifier">purchase</span>(<span class="ruby-value">1000</span>, <span class="ruby-identifier">creditcard</span>, <span class="ruby-value">:address</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">address</span>) <span class="ruby-comment"># charge 10 dollars</span>
</pre>

<p>1) <a href="Check.html"><code>Check</code></a> whether the transaction was successful</p>

<pre class="ruby"><span class="ruby-identifier">response</span>.<span class="ruby-identifier">success?</span>
</pre>

<p>2) Retrieve the message returned by PayJunction</p>

<pre class="ruby"><span class="ruby-identifier">response</span>.<span class="ruby-identifier">message</span>
</pre>

<p>3) Retrieve the unique transaction ID returned by PayJunction</p>

<pre class="ruby"><span class="ruby-identifier">response</span>.<span class="ruby-identifier">authorization</span>
</pre>

<p>This gateway supports “instant” transactions. These transactions allow you to execute an operation on a previously run card without card information provided you have the transaction id from a previous transaction with the same card. All functions that take a credit card object for this gateway can take a transaction id string instead.</p>

<p>Test Transactions</p>

<p>See the source for initialize() for test account information. Note that PayJunction does not allow test transactions on your account, so if the gateway is running in :test mode your transaction will be run against PayJunction&#39;s global test account and will not show up in your account.</p>

<p>Transactions ran on this account go through a test processor, so there is no need to void or otherwise cancel transactions. However, for further safety, please use the special card numbers 4433221111223344 or 4444333322221111 and keep transaction amounts below $4.00 when testing.</p>

<p>Also note, transactions ran for an amount between $0.00 and $1.99 will likely result in denial. To demonstrate approvals, use amounts between $2.00 and $4.00.</p>

<p>Test transactions can be checked by logging into PayJunction Web Login with username &#39;pj-cm-01&#39; and password &#39;pj-cm-01p&#39;</p>

<p>Usage Details</p>

<p>Below is a map of values accepted by PayJunction and how you should submit each to <a href="../../ActiveMerchant.html"><code>ActiveMerchant</code></a></p>

<p>PayJunction Field       <a href="../../ActiveMerchant.html"><code>ActiveMerchant</code></a> Use</p>

<p>dc_logon                provide as :login value to gateway instantiation dc_password             provide as :password value to gateway instantiation</p>

<p>dc_name                 will be retrieved from credit_card.name dc_first_name           :first_name on <a href="CreditCard.html"><code>CreditCard</code></a> object instantiation dc_last_name            :last_name  on <a href="CreditCard.html"><code>CreditCard</code></a> object instantiation dc_number               :number     on <a href="CreditCard.html"><code>CreditCard</code></a> object instantiation dc_expiration_month     :month      on <a href="CreditCard.html"><code>CreditCard</code></a> object instantiation dc_expiration_year      :year       on <a href="CreditCard.html"><code>CreditCard</code></a> object instantiation dc_verification_number  :verification_value on CC object instantiation</p>

<p>dc_transaction_amount   include as argument to method for your transaction type dc_transaction_type     do nothing, set by your transaction type dc_version              do nothing, always “1.2”</p>

<p>dc_transaction_id       submit as a string in place of <a href="CreditCard.html"><code>CreditCard</code></a> obj for</p>

<pre>&quot;instant&quot; transactions.</pre>

<p>dc_invoice              :order_id in options for transaction method dc_notes                :description in options for transaction method</p>

<p>See example use above for address AVS fields See <a href="PayJunctionGateway.html#method-i-recurring"><code>recurring</code></a> for periodic transaction fields</p>

  </section>

  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
      
        <dt id="API_VERSION">API_VERSION
        
        <dd>
        
      
        <dt id="DECLINE_CODES">DECLINE_CODES
        
        <dd>
        
      
        <dt id="FAILURE_MESSAGE">FAILURE_MESSAGE
        
        <dd>
        
      
        <dt id="SUCCESS_CODES">SUCCESS_CODES
        
        <dd>
        
      
        <dt id="SUCCESS_MESSAGE">SUCCESS_MESSAGE
        
        <dd>
        
      
        <dt id="TEST_LOGIN">TEST_LOGIN
        
        <dd>
        
      
        <dt id="TEST_PASSWORD">TEST_PASSWORD
        
        <dd>
        
      
      </dl>
    </section>
    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(options = {})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          
            <div class="method-calls-super">
              Calls superclass method
              <a href="Gateway.html#method-c-new"><code>ActiveMerchant::Billing::Gateway::new</code></a>
            </div>
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File active_merchant/lib/active_merchant/billing/gateways/pay_junction.rb, line 158</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">requires!</span>(<span class="ruby-identifier">options</span>, <span class="ruby-value">:login</span>, <span class="ruby-value">:password</span>)
  <span class="ruby-keyword">super</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-authorize" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">authorize</span><span
            class="method-args">(money, payment_source, options = {})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The first half of the preauth(authorize)/postauth(capture) model. Checks to make sure funds are available for a transaction, and returns a transaction_id that can be used later to postauthorize (capture) the funds.</p>
          
          

          
          <div class="method-source-code" id="authorize-source">
            <pre><span class="ruby-comment"># File active_merchant/lib/active_merchant/billing/gateways/pay_junction.rb, line 166</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">authorize</span>(<span class="ruby-identifier">money</span>, <span class="ruby-identifier">payment_source</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">parameters</span> = {
    <span class="ruby-value">transaction_amount:</span> <span class="ruby-identifier">amount</span>(<span class="ruby-identifier">money</span>)
  }

  <span class="ruby-identifier">add_payment_source</span>(<span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">payment_source</span>)
  <span class="ruby-identifier">add_address</span>(<span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">options</span>)
  <span class="ruby-identifier">add_optional_fields</span>(<span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">options</span>)
  <span class="ruby-identifier">commit</span>(<span class="ruby-string">&#39;AUTHORIZATION&#39;</span>, <span class="ruby-identifier">parameters</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-capture" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">capture</span><span
            class="method-args">(money, authorization, options = {})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The second half of the preauth(authorize)/postauth(capture) model. Retrieve funds that have been previously authorized with <em>authorization</em></p>
          
          

          
          <div class="method-source-code" id="capture-source">
            <pre><span class="ruby-comment"># File active_merchant/lib/active_merchant/billing/gateways/pay_junction.rb, line 192</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">capture</span>(<span class="ruby-identifier">money</span>, <span class="ruby-identifier">authorization</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">parameters</span> = {
    <span class="ruby-value">transaction_id:</span> <span class="ruby-identifier">authorization</span>,
    <span class="ruby-value">posture:</span> <span class="ruby-string">&#39;capture&#39;</span>
  }

  <span class="ruby-identifier">add_optional_fields</span>(<span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">options</span>)
  <span class="ruby-identifier">commit</span>(<span class="ruby-string">&#39;update&#39;</span>, <span class="ruby-identifier">parameters</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-credit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">credit</span><span
            class="method-args">(money, authorization, options = {})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="credit-source">
            <pre><span class="ruby-comment"># File active_merchant/lib/active_merchant/billing/gateways/pay_junction.rb, line 213</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">credit</span>(<span class="ruby-identifier">money</span>, <span class="ruby-identifier">authorization</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-constant">ActiveMerchant</span>.<span class="ruby-identifier">deprecated</span> <span class="ruby-constant">CREDIT_DEPRECATION_MESSAGE</span>
  <span class="ruby-identifier">refund</span>(<span class="ruby-identifier">money</span>, <span class="ruby-identifier">authorization</span>, <span class="ruby-identifier">options</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-purchase" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">purchase</span><span
            class="method-args">(money, payment_source, options = {})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>A simple sale, capturing funds immediately. Execute authorization and capture in a single step.</p>
          
          

          
          <div class="method-source-code" id="purchase-source">
            <pre><span class="ruby-comment"># File active_merchant/lib/active_merchant/billing/gateways/pay_junction.rb, line 179</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">purchase</span>(<span class="ruby-identifier">money</span>, <span class="ruby-identifier">payment_source</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">parameters</span> = {
    <span class="ruby-value">transaction_amount:</span> <span class="ruby-identifier">amount</span>(<span class="ruby-identifier">money</span>)
  }

  <span class="ruby-identifier">add_payment_source</span>(<span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">payment_source</span>)
  <span class="ruby-identifier">add_address</span>(<span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">options</span>)
  <span class="ruby-identifier">add_optional_fields</span>(<span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">options</span>)
  <span class="ruby-identifier">commit</span>(<span class="ruby-string">&#39;AUTHORIZATION_CAPTURE&#39;</span>, <span class="ruby-identifier">parameters</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-recurring" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">recurring</span><span
            class="method-args">(money, payment_source, options = {})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Set up a sale that will be made on a regular basis for the same amount (ex. $20 a month for 12 months)</p>

<p>The parameter :periodicity should be specified as either :monthly, :weekly, or :daily The parameter :payments should be the number of payments to be made</p>

<pre class="ruby"><span class="ruby-identifier">gateway</span>.<span class="ruby-identifier">recurring</span>(<span class="ruby-string">&#39;2000&#39;</span>, <span class="ruby-identifier">creditcard</span>, <span class="ruby-value">:periodicity</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">:monthly</span>, <span class="ruby-value">:payments</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">12</span>)
</pre>

<p>The optional parameter :starting_at takes a date or time argument or a string in YYYYMMDD format and can be used to specify when the first charge will be made. If omitted the first charge will be immediate.</p>
          
          

          
          <div class="method-source-code" id="recurring-source">
            <pre><span class="ruby-comment"># File active_merchant/lib/active_merchant/billing/gateways/pay_junction.rb, line 241</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">recurring</span>(<span class="ruby-identifier">money</span>, <span class="ruby-identifier">payment_source</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-constant">ActiveMerchant</span>.<span class="ruby-identifier">deprecated</span> <span class="ruby-constant">RECURRING_DEPRECATION_MESSAGE</span>

  <span class="ruby-identifier">requires!</span>(<span class="ruby-identifier">options</span>, <span class="ruby-node">%i[periodicity monthly weekly daily]</span>, <span class="ruby-value">:payments</span>)

  <span class="ruby-identifier">periodic_type</span> =
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:periodicity</span>]
    <span class="ruby-keyword">when</span> <span class="ruby-value">:monthly</span>
      <span class="ruby-string">&#39;month&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">:weekly</span>
      <span class="ruby-string">&#39;week&#39;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">:daily</span>
      <span class="ruby-string">&#39;day&#39;</span>
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:starting_at</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">start_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&#39;%Y-%m-%d&#39;</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:starting_at</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
    <span class="ruby-identifier">sa</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:starting_at</span>]
    <span class="ruby-identifier">start_date</span> = <span class="ruby-node">&quot;#{sa[0..3]}-#{sa[4..5]}-#{sa[6..7]}&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">start_date</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:starting_at</span>].<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&#39;%Y-%m-%d&#39;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">parameters</span> = {
    <span class="ruby-value">transaction_amount:</span> <span class="ruby-identifier">amount</span>(<span class="ruby-identifier">money</span>),
    <span class="ruby-value">schedule_periodic_type:</span> <span class="ruby-identifier">periodic_type</span>,
    <span class="ruby-value">schedule_create:</span> <span class="ruby-string">&#39;true&#39;</span>,
    <span class="ruby-value">schedule_limit:</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:payments</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:payments</span>] <span class="ruby-operator">:</span> <span class="ruby-value">1</span>,
    <span class="ruby-value">schedule_periodic_number:</span> <span class="ruby-value">1</span>,
    <span class="ruby-value">schedule_start:</span> <span class="ruby-identifier">start_date</span>
  }

  <span class="ruby-identifier">add_payment_source</span>(<span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">payment_source</span>)
  <span class="ruby-identifier">add_optional_fields</span>(<span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">options</span>)
  <span class="ruby-identifier">add_address</span>(<span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">options</span>)
  <span class="ruby-identifier">commit</span>(<span class="ruby-string">&#39;AUTHORIZATION_CAPTURE&#39;</span>, <span class="ruby-identifier">parameters</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-refund" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">refund</span><span
            class="method-args">(money, authorization, options = {})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Return money to a card that was previously billed. <em>authorization</em> should be the transaction id of the transaction we are returning.</p>
          
          

          
          <div class="method-source-code" id="refund-source">
            <pre><span class="ruby-comment"># File active_merchant/lib/active_merchant/billing/gateways/pay_junction.rb, line 204</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">refund</span>(<span class="ruby-identifier">money</span>, <span class="ruby-identifier">authorization</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">parameters</span> = {
    <span class="ruby-value">transaction_amount:</span> <span class="ruby-identifier">amount</span>(<span class="ruby-identifier">money</span>),
    <span class="ruby-value">transaction_id:</span> <span class="ruby-identifier">authorization</span>
  }

  <span class="ruby-identifier">commit</span>(<span class="ruby-string">&#39;CREDIT&#39;</span>, <span class="ruby-identifier">parameters</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-test-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          
            <div class="method-calls-super">
              Calls superclass method
              <a href="Gateway.html#method-i-test-3F"><code>ActiveMerchant::Billing::Gateway#test?</code></a>
            </div>
          

          
          <div class="method-source-code" id="test-3F-source">
            <pre><span class="ruby-comment"># File active_merchant/lib/active_merchant/billing/gateways/pay_junction.rb, line 280</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">test?</span>
  (<span class="ruby-identifier">test_login?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">super</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-void" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">void</span><span
            class="method-args">(authorization, options = {})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Cancel a transaction that has been charged but has not yet made it through the batch process.</p>
          
          

          
          <div class="method-source-code" id="void-source">
            <pre><span class="ruby-comment"># File active_merchant/lib/active_merchant/billing/gateways/pay_junction.rb, line 220</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">void</span>(<span class="ruby-identifier">authorization</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">parameters</span> = {
    <span class="ruby-value">transaction_id:</span> <span class="ruby-identifier">authorization</span>,
    <span class="ruby-value">posture:</span> <span class="ruby-string">&#39;void&#39;</span>
  }

  <span class="ruby-identifier">add_optional_fields</span>(<span class="ruby-identifier">parameters</span>, <span class="ruby-identifier">options</span>)
  <span class="ruby-identifier">commit</span>(<span class="ruby-string">&#39;update&#39;</span>, <span class="ruby-identifier">parameters</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>

</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.2.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

